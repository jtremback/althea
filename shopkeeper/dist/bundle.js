(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var key in props) { var prop = props[key]; prop.configurable = true; if (prop.value) prop.writable = true; } Object.defineProperties(target, props); } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _classCallCheck = function (instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } };

// This simulation consists of a small network of nodes, each node randomly
// pings other nodes in a fixed proportion. So for example, node B may ping
// node E 40% of the time, and node D 60% of the time. Some of the nodes are
// not directly connected, so a naive routing algorithm is used.
//
// The output, for each node, is a list of the node's peers, along with number
// of pings forwarded to other peers. For example, node E might
// have an output like this:
//
// Node E:
//   Peer B: 12 pings to D, 9 pings to G
//   Peer D: 5 pings to B, 9 pings to G
//   Peer G: 0 pings to D, 30 pings to B

var nodes = {
  A: {
    peers: {
      C: { cost: 0 }
    },
    routes: {
      A: null,
      B: "C",
      C: "C",
      D: "C",
      E: "C",
      F: "C",
      G: "C" },
    pings: {
      E: 3,
      F: 7
    }
  },
  B: {
    peers: {
      E: { cost: 0 },
      D: { cost: 0 } },
    routes: {
      A: "D",
      B: null,
      C: "D",
      D: "D",
      E: "E",
      F: "D",
      G: "E"
    },
    pings: {
      A: 4,
      G: 2
    }
  },
  C: {
    peers: {
      A: { cost: 0 },
      D: { cost: 0 } },
    routes: {
      A: "A",
      B: "D",
      C: null,
      D: "D",
      E: "D",
      F: "D",
      G: "G"
    },
    pings: {
      D: 8,
      B: 4
    }
  },
  D: {
    peers: {
      B: { cost: 0 },
      C: { cost: 0 },
      E: { cost: 0 },
      F: { cost: 0 } },
    routes: {
      A: "C",
      B: "B",
      C: "C",
      D: null,
      E: "E",
      F: "F",
      G: "F"
    },
    pings: {
      C: 4,
      G: 9
    }
  },
  E: {
    peers: {
      B: { cost: 0 },
      D: { cost: 0 },
      G: { cost: 0 } },
    routes: {
      A: "D",
      B: "B",
      C: "D",
      D: "D",
      E: null,
      F: "D",
      G: "G"
    },
    pings: {
      F: 5,
      A: 12
    }
  },
  F: {
    peers: {
      D: { cost: 0 },
      E: { cost: 0 },
      G: { cost: 0 } },
    routes: {
      A: "D",
      B: "D",
      C: "D",
      D: "D",
      E: "G",
      F: null,
      G: "G"
    },
    pings: {
      B: 3,
      D: 9
    }
  },
  G: {
    peers: {
      E: { cost: 0 },
      F: { cost: 0 } },
    routes: {
      A: "F",
      B: "E",
      C: "F",
      D: "F",
      E: "E",
      F: "F",
      G: null
    },
    pings: {
      B: 4,
      C: 5
    }
  }
};

var Node = (function () {
  function Node(id, opts) {
    _classCallCheck(this, Node);

    this.id = id;
    this.peers = opts.peers;
    this.routes = opts.routes;
    this.pings = opts.pings;
    this.stats = {
      forwardedTo: {}
    };
  }

  _createClass(Node, {
    recieve: {
      value: function recieve(message, peerFrom) {
        if (message.header.destinationAddress === this.id) {} else {
          // Forward along
          this.send(message, peerFrom);
        }
      }
    },
    send: {
      value: function send(message, peerFrom) {
        // Get peer for destinationAddress
        var peerTo = this.routes[message.header.destinationAddress];

        if (peerFrom) {
          console.log("forwarding message from " + peerFrom + " to " + peerTo);
          // Log forwarding stats
          if (!this.stats.forwardedTo[peerTo]) {
            this.stats.forwardedTo[peerTo] = {};
          }
          if (!this.stats.forwardedTo[peerTo][peerFrom]) {
            this.stats.forwardedTo[peerTo][peerFrom] = 0;
          }
          this.stats.forwardedTo[peerTo][peerFrom] = this.stats.forwardedTo[peerTo][peerFrom] + 1;
        }

        // Send to peer
        nodes[peerTo].recieve(message, this.id);
      }
    },
    pingPeers: {
      value: function pingPeers() {
        for (var id in this.pings) {
          for (var i = 0; i < this.pings[id]; i++) {
            this.send({
              header: {
                destinationAddress: id,
                sourceAddress: this.id
              },
              body: "ping"
            });
          }
        }
      }
    },
    getStats: {
      value: function getStats() {
        return this.stats;
      }
    }
  });

  return Node;
})();

function makeNodes(nodes) {
  for (var id in nodes) {
    nodes[id] = new Node(id, nodes[id]);
  }
}

makeNodes(nodes);

for (var key in nodes) {
  nodes[key].pingPeers();
}

for (var key in nodes) {
  console.log(nodes[key].getStats());
}

//   A: {
//     B: 10
//   }

// console.log(this.id, 'recieved', message.body, 'from', message.header.sourceAddress, 'via', peerFrom)

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy93YXRjaGlmeS9ub2RlX21vZHVsZXMvYnJvd3NlcmlmeS9ub2RlX21vZHVsZXMvYnJvd3Nlci1wYWNrL19wcmVsdWRlLmpzIiwiL1VzZXJzL2plaGFuL2FsdGhlYS9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDY0EsSUFBSSxLQUFLLEdBQUc7QUFDVixHQUFDLEVBQUU7QUFDRCxTQUFLLEVBQUU7QUFDTCxPQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFO0tBQ2Y7QUFDRCxVQUFNLEVBQUU7QUFDTixPQUFDLEVBQUUsSUFBSTtBQUNQLE9BQUMsRUFBRSxHQUFHO0FBQ04sT0FBQyxFQUFFLEdBQUc7QUFDTixPQUFDLEVBQUUsR0FBRztBQUNOLE9BQUMsRUFBRSxHQUFHO0FBQ04sT0FBQyxFQUFFLEdBQUc7QUFDTixPQUFDLEVBQUUsR0FBRyxFQUNQO0FBQ0QsU0FBSyxFQUFFO0FBQ0wsT0FBQyxFQUFFLENBQUM7QUFDSixPQUFDLEVBQUUsQ0FBQztLQUNMO0dBQ0Y7QUFDRCxHQUFDLEVBQUU7QUFDRCxTQUFLLEVBQUU7QUFDTCxPQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFO0FBQ2QsT0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUNmO0FBQ0QsVUFBTSxFQUFFO0FBQ04sT0FBQyxFQUFFLEdBQUc7QUFDTixPQUFDLEVBQUUsSUFBSTtBQUNQLE9BQUMsRUFBRSxHQUFHO0FBQ04sT0FBQyxFQUFFLEdBQUc7QUFDTixPQUFDLEVBQUUsR0FBRztBQUNOLE9BQUMsRUFBRSxHQUFHO0FBQ04sT0FBQyxFQUFFLEdBQUc7S0FDUDtBQUNELFNBQUssRUFBRTtBQUNMLE9BQUMsRUFBRSxDQUFDO0FBQ0osT0FBQyxFQUFFLENBQUM7S0FDTDtHQUNGO0FBQ0QsR0FBQyxFQUFFO0FBQ0QsU0FBSyxFQUFFO0FBQ0wsT0FBQyxFQUFFLEVBQUUs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QUFDLEtBQUssQ0FBQyxDQUFBOztBQUVoQixLQUFLLElBQUksR0FBRyxJQUFJLEtBQUssRUFBRTtBQUNyQixPQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUE7Q0FDdkI7O0FBRUQsS0FBSyxJQUFJLEdBQUcsSUFBSSxLQUFLLEVBQUU7QUFDckIsU0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQTtDQUNuQyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBUaGlzIHNpbXVsYXRpb24gY29uc2lzdHMgb2YgYSBzbWFsbCBuZXR3b3JrIG9mIG5vZGVzLCBlYWNoIG5vZGUgcmFuZG9tbHlcbi8vIHBpbmdzIG90aGVyIG5vZGVzIGluIGEgZml4ZWQgcHJvcG9ydGlvbi4gU28gZm9yIGV4YW1wbGUsIG5vZGUgQiBtYXkgcGluZ1xuLy8gbm9kZSBFIDQwJSBvZiB0aGUgdGltZSwgYW5kIG5vZGUgRCA2MCUgb2YgdGhlIHRpbWUuIFNvbWUgb2YgdGhlIG5vZGVzIGFyZVxuLy8gbm90IGRpcmVjdGx5IGNvbm5lY3RlZCwgc28gYSBuYWl2ZSByb3V0aW5nIGFsZ29yaXRobSBpcyB1c2VkLlxuLy9cbi8vIFRoZSBvdXRwdXQsIGZvciBlYWNoIG5vZGUsIGlzIGEgbGlzdCBvZiB0aGUgbm9kZSdzIHBlZXJzLCBhbG9uZyB3aXRoIG51bWJlclxuLy8gb2YgcGluZ3MgZm9yd2FyZGVkIHRvIG90aGVyIHBlZXJzLiBGb3IgZXhhbXBsZSwgbm9kZSBFIG1pZ2h0XG4vLyBoYXZlIGFuIG91dHB1dCBsaWtlIHRoaXM6XG4vL1xuLy8gTm9kZSBFOlxuLy8gICBQZWVyIEI6IDEyIHBpbmdzIHRvIEQsIDkgcGluZ3MgdG8gR1xuLy8gICBQZWVyIEQ6IDUgcGluZ3MgdG8gQiwgOSBwaW5ncyB0byBHXG4vLyAgIFBlZXIgRzogMCBwaW5ncyB0byBELCAzMCBwaW5ncyB0byBCXG5cbmxldCBub2RlcyA9IHtcbiAgQToge1xuICAgIHBlZXJzOiB7XG4gICAgICBDOiB7IGNvc3Q6IDAgfVxuICAgIH0sXG4gICAgcm91dGVzOiB7XG4gICAgICBBOiBudWxsLFxuICAgICAgQjogJ0MnLFxuICAgICAgQzogJ0MnLFxuICAgICAgRDogJ0MnLFxuICAgICAgRTogJ0MnLFxuICAgICAgRjogJ0MnLFxuICAgICAgRzogJ0MnLFxuICAgIH0sXG4gICAgcGluZ3M6IHtcbiAgICAgIEU6IDMsXG4gICAgICBGOiA3XG4gICAgfVxuICB9LFxuICBCOiB7XG4gICAgcGVlcnM6IHtcbiAgICAgIEU6IHsgY29zdDogMCB9LFxuICAgICAgRDogeyBjb3N0OiAwIH0sXG4gICAgfSxcbiAgICByb3V0ZXM6IHtcbiAgICAgIEE6ICdEJyxcbiAgICAgIEI6IG51bGwsXG4gICAgICBDOiAnRCcsXG4gICAgICBEOiAnRCcsXG4gICAgICBFOiAnRScsXG4gICAgICBGOiAnRCcsXG4gICAgICBHOiAnRSdcbiAgICB9LFxuICAgIHBpbmdzOiB7XG4gICAgICBBOiA0LFxuICAgICAgRzogMlxuICAgIH1cbiAgfSxcbiAgQzoge1xuICAgIHBlZXJzOiB7XG4gICAgICBBOiB7IGNvc3Q6IDAgfSxcbiAgICAgIEQ6IHsgY29zdDogMCB9LFxuICAgIH0sXG4gICAgcm91dGVzOiB7XG4gICAgICBBOiAnQScsXG4gICAgICBCOiAnRCcsXG4gICAgICBDOiBudWxsLFxuICAgICAgRDogJ0QnLFxuICAgICAgRTogJ0QnLFxuICAgICAgRjogJ0QnLFxuICAgICAgRzogJ0cnXG4gICAgfSxcbiAgICBwaW5nczoge1xuICAgICAgRDogOCxcbiAgICAgIEI6IDRcbiAgICB9XG4gIH0sXG4gIEQ6IHtcbiAgICBwZWVyczoge1xuICAgICAgQjogeyBjb3N0OiAwIH0sXG4gICAgICBDOiB7IGNvc3Q6IDAgfSxcbiAgICAgIEU6IHsgY29zdDogMCB9LFxuICAgICAgRjogeyBjb3N0OiAwIH0sXG4gICAgfSxcbiAgICByb3V0ZXM6IHtcbiAgICAgIEE6ICdDJyxcbiAgICAgIEI6ICdCJyxcbiAgICAgIEM6ICdDJyxcbiAgICAgIEQ6IG51bGwsXG4gICAgICBFOiAnRScsXG4gICAgICBGOiAnRicsXG4gICAgICBHOiAnRidcbiAgICB9LFxuICAgIHBpbmdzOiB7XG4gICAgICBDOiA0LFxuICAgICAgRzogOVxuICAgIH1cbiAgfSxcbiAgRToge1xuICAgIHBlZXJzOiB7XG4gICAgICBCOiB7IGNvc3Q6IDAgfSxcbiAgICAgIEQ6IHsgY29zdDogMCB9LFxuICAgICAgRzogeyBjb3N0OiAwIH0sXG4gICAgfSxcbiAgICByb3V0ZXM6IHtcbiAgICAgIEE6ICdEJyxcbiAgICAgIEI6ICdCJyxcbiAgICAgIEM6ICdEJyxcbiAgICAgIEQ6ICdEJyxcbiAgICAgIEU6IG51bGwsXG4gICAgICBGOiAnRCcsXG4gICAgICBHOiAnRydcbiAgICB9LFxuICAgIHBpbmdzOiB7XG4gICAgICBGOiA1LFxuICAgICAgQTogMTJcbiAgICB9XG4gIH0sXG4gIEY6IHtcbiAgICBwZWVyczoge1xuICAgICAgRDogeyBjb3N0OiAwIH0sXG4gICAgICBFOiB7IGNvc3Q6IDAgfSxcbiAgICAgIEc6IHsgY29zdDogMCB9LFxuICAgIH0sXG4gICAgcm91dGVzOiB7XG4gICAgICBBOiAnRCcsXG4gICAgICBCOiAnRCcsXG4gICAgICBDOiAnRCcsXG4gICAgICBEOiAnRCcsXG4gICAgICBFOiAnRycsXG4gICAgICBGOiBudWxsLFxuICAgICAgRzogJ0cnXG4gICAgfSxcbiAgICBwaW5nczoge1xuICAgICAgQjogMyxcbiAgICAgIEQ6IDlcbiAgICB9XG4gIH0sXG4gIEc6IHtcbiAgICBwZWVyczoge1xuICAgICAgRTogeyBjb3N0OiAwIH0sXG4gICAgICBGOiB7IGNvc3Q6IDAgfSxcbiAgICB9LFxuICAgIHJvdXRlczoge1xuICAgICAgQTogJ0YnLFxuICAgICAgQjogJ0UnLFxuICAgICAgQzogJ0YnLFxuICAgICAgRDogJ0YnLFxuICAgICAgRTogJ0UnLFxuICAgICAgRjogJ0YnLFxuICAgICAgRzogbnVsbFxuICAgIH0sXG4gICAgcGluZ3M6IHtcbiAgICAgIEI6IDQsXG4gICAgICBDOiA1XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIE5vZGUge1xuICBjb25zdHJ1Y3RvciAoaWQsIG9wdHMpIHtcbiAgICB0aGlzLmlkID0gaWRcbiAgICB0aGlzLnBlZXJzID0gb3B0cy5wZWVyc1xuICAgIHRoaXMucm91dGVzID0gb3B0cy5yb3V0ZXNcbiAgICB0aGlzLnBpbmdzID0gb3B0cy5waW5nc1xuICAgIHRoaXMuc3RhdHMgPSB7XG4gICAgICBmb3J3YXJkZWRUbzoge1xuICAgICAgLy8gICBBOiB7XG4gICAgICAvLyAgICAgQjogMTBcbiAgICAgIC8vICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlY2lldmUgKG1lc3NhZ2UsIHBlZXJGcm9tKSB7XG4gICAgaWYgKG1lc3NhZ2UuaGVhZGVyLmRlc3RpbmF0aW9uQWRkcmVzcyA9PT0gdGhpcy5pZCkge1xuICAgICAgLy8gY29uc29sZS5sb2codGhpcy5pZCwgJ3JlY2lldmVkJywgbWVzc2FnZS5ib2R5LCAnZnJvbScsIG1lc3NhZ2UuaGVhZGVyLnNvdXJjZUFkZHJlc3MsICd2aWEnLCBwZWVyRnJvbSlcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRm9yd2FyZCBhbG9uZ1xuICAgICAgdGhpcy5zZW5kKG1lc3NhZ2UsIHBlZXJGcm9tKVxuICAgIH1cbiAgfVxuXG4gIHNlbmQgKG1lc3NhZ2UsIHBlZXJGcm9tKSB7XG4gICAgLy8gR2V0IHBlZXIgZm9yIGRlc3RpbmF0aW9uQWRkcmVzc1xuICAgIGxldCBwZWVyVG8gPSB0aGlzLnJvdXRlc1ttZXNzYWdlLmhlYWRlci5kZXN0aW5hdGlvbkFkZHJlc3NdXG5cbiAgICBpZiAocGVlckZyb20pIHtcbiAgICAgIGNvbnNvbGUubG9nKCdmb3J3YXJkaW5nIG1lc3NhZ2UgZnJvbSAnICsgcGVlckZyb20gKyAnIHRvICcgKyBwZWVyVG8pXG4gICAgICAvLyBMb2cgZm9yd2FyZGluZyBzdGF0c1xuICAgICAgaWYgKCF0aGlzLnN0YXRzLmZvcndhcmRlZFRvW3BlZXJUb10pIHtcbiAgICAgICAgdGhpcy5zdGF0cy5mb3J3YXJkZWRUb1twZWVyVG9dID0ge31cbiAgICAgIH1cbiAgICAgIGlmICghdGhpcy5zdGF0cy5mb3J3YXJkZWRUb1twZWVyVG9dW3BlZXJGcm9tXSkge1xuICAgICAgICB0aGlzLnN0YXRzLmZvcndhcmRlZFRvW3BlZXJUb11bcGVlckZyb21dID0gMFxuICAgICAgfVxuICAgICAgdGhpcy5zdGF0cy5mb3J3YXJkZWRUb1twZWVyVG9dW3BlZXJGcm9tXSA9IHRoaXMuc3RhdHMuZm9yd2FyZGVkVG9bcGVlclRvXVtwZWVyRnJvbV0gKyAxXG4gICAgfVxuXG5cbiAgICAvLyBTZW5kIHRvIHBlZXJcbiAgICBub2Rlc1twZWVyVG9dLnJlY2lldmUobWVzc2FnZSwgdGhpcy5pZClcbiAgfVxuXG4gIHBpbmdQZWVycyAoKSB7XG4gICAgZm9yIChsZXQgaWQgaW4gdGhpcy5waW5ncykge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBpbmdzW2lkXTsgaSsrKSB7XG4gICAgICAgIHRoaXMuc2VuZCh7XG4gICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICBkZXN0aW5hdGlvbkFkZHJlc3M6IGlkLFxuICAgICAgICAgICAgc291cmNlQWRkcmVzczogdGhpcy5pZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogJ3BpbmcnXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0U3RhdHMgKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRzXG4gIH1cbn1cblxuXG5mdW5jdGlvbiBtYWtlTm9kZXMgKG5vZGVzKSB7XG4gIGZvciAobGV0IGlkIGluIG5vZGVzKSB7XG4gICAgbm9kZXNbaWRdID0gbmV3IE5vZGUoaWQsIG5vZGVzW2lkXSlcbiAgfVxufVxuXG5tYWtlTm9kZXMobm9kZXMpXG5cbmZvciAobGV0IGtleSBpbiBub2Rlcykge1xuICBub2Rlc1trZXldLnBpbmdQZWVycygpXG59XG5cbmZvciAobGV0IGtleSBpbiBub2Rlcykge1xuICBjb25zb2xlLmxvZyhub2Rlc1trZXldLmdldFN0YXRzKCkpXG59XG4iXX0=
